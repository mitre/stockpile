---

- id: 5d82da6f-ebf5-4ed6-ab4d-0cae90281aa6
  name: Compress & Encrypt Staged Directory
  description: compress and encrypt staged directory
  tactic: collection
  technique:
    attack_id: T1074
    name: Data Staged
  executors:
    darwin:
      command: |
        tar -czvf #{files}/staged.tgz #{files}/staged;
        openssl enc -aes-256-cbc -salt -in #{files}/staged.tgz -out #{files}/staged.tgz.enc -k password123 ;
      cleanup: |
        rm #{files}/staged.tgz; rm #{files}/staged.tgz.enc;
    linux:
      command: |
        tar -czvf #{files}/staged.tgz #{files}/staged;
        openssl enc -aes-256-cbc -salt -in #{files}/staged.tgz -out #{files}/staged.tgz.enc -k password123 ;
      cleanup: |
        rm #{files}/staged.tgz; rm #{files}/staged.tgz.enc;
    windows:
      command: |
        Compress-Archive -Path #{files}\staged -DestinationPath #{files}\staged;
        #{files}\xor.ps1 #{files}\staged.zip;
      payload: xor.ps1
      cleanup: |
        Remove-Item -Path "#{files}\staged.zip"; Remove-Item -Path "#{files}\staged.zip.enc";

  # see 6469befa-748a-4b9c-a96d-f191fde47d89 for creation of directory 'staged'
